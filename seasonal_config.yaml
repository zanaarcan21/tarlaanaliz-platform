# =============================================================================
# TarlaAnaliz - Seasonal Rate Limits Configuration
# =============================================================================
# SSOT Referans: TARLAANALIZ_SSOT_v2_6_0.md (KR-024 - Önerilen tarama periyodu)
# Versiyon: v2.6.0
# 
# Bu dosya tarımsal sezonlara göre dinamik rate limiting ve kapasite ayarlarını tanımlar.
# Bitki türlerine göre yoğunluk dönemleri farklıdır.
# =============================================================================

# -----------------------------------------------------------------------------
# Seasonal Configuration Strategy
# -----------------------------------------------------------------------------
strategy:
  enabled: true
  auto_adjust: true  # Sezonlara göre otomatik ayarlama
  
  # Sezon tespiti
  detection:
    method: calendar  # Options: calendar, weather_api, manual
    timezone: "Europe/Istanbul"
    check_interval_hours: 24  # Her 24 saatte bir sezon kontrolü
  
  # Ayarlama stratejisi
  adjustment:
    type: multiplier  # base_limits.yaml'daki değerler multiplier ile çarpılır
    notification_enabled: true  # Admin'e sezon değişikliği bildirimi
    audit_log: true  # Tüm sezon değişiklikleri loglanır

# -----------------------------------------------------------------------------
# Crop-Specific Seasons (Bitki Türü Bazlı Sezonlar)
# -----------------------------------------------------------------------------
# SSOT KR-024: Önerilen tarama periyodları burada tanımlanır

crops:
  # PAMUK (Cotton)
  COTTON:
    # Ekim: Nisan sonu - Mayıs başı
    planting_season:
      months: [4, 5]
      scanning_frequency_days: 21  # 3 hafta
      rate_multiplier: 1.0  # Normal limit
    
    # Büyüme: Haziran - Ağustos
    growth_season:
      months: [6, 7, 8]
      scanning_frequency_days: 14  # 2 hafta (SSOT önerisi)
      rate_multiplier: 1.5  # %50 daha fazla istek
    
    # Hasat: Eylül - Ekim
    harvest_season:
      months: [9, 10]
      scanning_frequency_days: 7  # 1 hafta (kritik dönem)
      rate_multiplier: 2.0  # 2x limit
    
    # Dinlenme: Kasım - Mart
    dormant_season:
      months: [11, 12, 1, 2, 3]
      scanning_frequency_days: null  # Tarama yok
      rate_multiplier: 0.5  # Düşük limit (sadece kayıt/güncelleme)
  
  # BUĞDAY (Wheat)
  WHEAT:
    # Ekim: Ekim - Kasım
    planting_season:
      months: [10, 11]
      scanning_frequency_days: 21
      rate_multiplier: 1.2
    
    # Kış dönem: Aralık - Şubat
    winter_season:
      months: [12, 1, 2]
      scanning_frequency_days: 30  # Ayda 1
      rate_multiplier: 0.7
    
    # Gelişme: Mart - Nisan
    growth_season:
      months: [3, 4]
      scanning_frequency_days: 14  # 2 hafta
      rate_multiplier: 1.5
    
    # Hasat: Mayıs - Haziran
    harvest_season:
      months: [5, 6]
      scanning_frequency_days: 7  # 1 hafta
      rate_multiplier: 2.0
    
    # Dinlenme: Temmuz - Eylül
    dormant_season:
      months: [7, 8, 9]
      scanning_frequency_days: null
      rate_multiplier: 0.5
  
  # MISIR (Corn)
  CORN:
    # Ekim: Nisan - Mayıs
    planting_season:
      months: [4, 5]
      scanning_frequency_days: 21
      rate_multiplier: 1.0
    
    # Büyüme: Haziran - Ağustos
    growth_season:
      months: [6, 7, 8]
      scanning_frequency_days: 10  # 10 gün (SSOT önerisi)
      rate_multiplier: 1.8
    
    # Hasat: Eylül - Ekim
    harvest_season:
      months: [9, 10]
      scanning_frequency_days: 7
      rate_multiplier: 2.0
    
    # Dinlenme: Kasım - Mart
    dormant_season:
      months: [11, 12, 1, 2, 3]
      scanning_frequency_days: null
      rate_multiplier: 0.5
  
  # SEBZE (Vegetables - genel)
  VEGETABLES:
    # Sezon boyunca aktif
    active_season:
      months: [3, 4, 5, 6, 7, 8, 9, 10]
      scanning_frequency_days: 7  # Haftada 1 (SSOT önerisi)
      rate_multiplier: 2.5  # Yoğun takip
    
    # Kış dönemi
    winter_season:
      months: [11, 12, 1, 2]
      scanning_frequency_days: 14
      rate_multiplier: 1.0
  
  # ANTEPFISTIĞI (Pistachio)
  PISTACHIO:
    # İlkbahar: Mart - Mayıs
    spring_season:
      months: [3, 4, 5]
      scanning_frequency_days: 21
      rate_multiplier: 1.3
    
    # Yaz: Haziran - Ağustos
    summer_season:
      months: [6, 7, 8]
      scanning_frequency_days: 14  # 2 hafta
      rate_multiplier: 1.5
    
    # Hasat: Eylül - Ekim
    harvest_season:
      months: [9, 10]
      scanning_frequency_days: 7
      rate_multiplier: 2.0
    
    # Kış: Kasım - Şubat
    winter_season:
      months: [11, 12, 1, 2]
      scanning_frequency_days: 30  # Ayda 1
      rate_multiplier: 0.6
  
  # ZEYTIN (Olive)
  OLIVE:
    # İlkbahar: Mart - Mayıs
    spring_season:
      months: [3, 4, 5]
      scanning_frequency_days: 21
      rate_multiplier: 1.2
    
    # Yaz: Haziran - Ağustos
    summer_season:
      months: [6, 7, 8]
      scanning_frequency_days: 21
      rate_multiplier: 1.3
    
    # Hasat: Eylül - Aralık
    harvest_season:
      months: [9, 10, 11, 12]
      scanning_frequency_days: 14
      rate_multiplier: 1.8
    
    # Kış: Ocak - Şubat
    winter_season:
      months: [1, 2]
      scanning_frequency_days: 30
      rate_multiplier: 0.7

# -----------------------------------------------------------------------------
# Regional Adjustments (Bölgesel Ayarlamalar)
# -----------------------------------------------------------------------------
# GAP bölgesi öncelikli, diğer bölgeler ölçeklendikçe eklenir

regions:
  # GAP Bölgesi (Güneydoğu Anadolu Projesi)
  GAP:
    provinces:
      - "63"  # Şanlıurfa
      - "27"  # Gaziantep
      - "21"  # Diyarbakır
      - "73"  # Şırnak
      - "56"  # Siirt
      - "72"  # Batman
      - "47"  # Mardin
      - "02"  # Adıyaman
      - "49"  # Kilis
    
    # Bölge özelinde çarpan (GAP yoğun)
    rate_multiplier: 1.5
    
    # Pilot yoğunluğu
    pilot_density: high  # high, medium, low
    
    # Kapasite
    capacity:
      max_concurrent_missions: 100
      max_daily_uploads: 500
    
    # Öncelik
    priority: high  # SLA'lar daha sıkı
  
  # İç Anadolu (gelecek ekspansiyon)
  CENTRAL_ANATOLIA:
    provinces:
      - "06"  # Ankara
      - "42"  # Konya
      - "50"  # Nevşehir
      - "68"  # Aksaray
    
    rate_multiplier: 1.2
    pilot_density: medium
    capacity:
      max_concurrent_missions: 50
      max_daily_uploads: 200
    priority: medium
  
  # Ege (gelecek ekspansiyon)
  AEGEAN:
    provinces:
      - "35"  # İzmir
      - "09"  # Aydın
      - "20"  # Denizli
      - "45"  # Manisa
    
    rate_multiplier: 1.3
    pilot_density: medium
    capacity:
      max_concurrent_missions: 60
      max_daily_uploads: 250
    priority: medium

# -----------------------------------------------------------------------------
# Peak Hours (Yoğun Saatler)
# -----------------------------------------------------------------------------
peak_hours:
  enabled: true
  
  # İş saatleri (yoğun)
  business_hours:
    days: [1, 2, 3, 4, 5]  # Pazartesi - Cuma
    hours: [9, 10, 11, 12, 13, 14, 15, 16, 17, 18]  # 09:00 - 18:00
    rate_multiplier: 1.2
  
  # Hafta sonu (düşük)
  weekend:
    days: [6, 0]  # Cumartesi - Pazar
    rate_multiplier: 0.8
  
  # Gece (çok düşük)
  night_hours:
    hours: [0, 1, 2, 3, 4, 5, 22, 23]  # 00:00 - 05:00, 22:00 - 23:59
    rate_multiplier: 0.5

# -----------------------------------------------------------------------------
# Weather-Based Adjustments (Hava Durumu Bazlı)
# -----------------------------------------------------------------------------
# Opsiyonel: Hava durumu API'si entegre edilirse
weather:
  enabled: false  # Gelecek özellik
  
  # Uçuş yapılamayan hava koşulları
  no_fly_conditions:
    - heavy_rain
    - strong_wind  # >15 m/s
    - storm
    - fog
    - snow
  
  # Kötü hava durumunda limitler azalır (yüklemeler olmaz)
  bad_weather_multiplier: 0.3
  
  # API ayarları
  weather_api:
    provider: openweathermap  # veya mgm (Meteoroloji Genel Müdürlüğü)
    api_key: "${WEATHER_API_KEY}"
    check_interval_minutes: 30
    forecast_hours: 24

# -----------------------------------------------------------------------------
# Subscription Scheduler Integration (SSOT: KR-027)
# -----------------------------------------------------------------------------
subscription:
  # Abonelik bazlı otomatik mission oluşturma
  auto_scheduling:
    enabled: true
    
    # Bildirim zamanlaması
    notification:
      before_days: 2  # 2 gün önceden bildirim
      reminder_days: 1  # 1 gün önceden hatırlatma
    
    # Batch processing
    batch_size: 100  # Her seferde 100 abonelik işlenir
    processing_time: "02:00"  # Gece 02:00'de çalıştır
    
    # Sezonsal ayarlamalar
    respect_crop_season: true  # Bitki sezonuna uygun tarama sıklığı
    skip_dormant_season: true  # Dinlenme sezonunda mission oluşturma

# -----------------------------------------------------------------------------
# Emergency Overrides (Acil Durum Ayarlamaları)
# -----------------------------------------------------------------------------
emergency:
  # Acil durum modu (admin tarafından manuel aktif edilir)
  enabled: false
  
  # Acil durum senaryoları
  scenarios:
    # Salgın/hastalık yayılımı
    disease_outbreak:
      rate_multiplier: 3.0  # 3x limit
      priority: critical
      auto_schedule_affected_fields: true
    
    # Doğal afet
    natural_disaster:
      rate_multiplier: 0.2  # Düşük limit (sistem stabilitesi)
      priority: low
      pause_normal_operations: true
    
    # Sistem bakımı
    maintenance:
      rate_multiplier: 0.1  # Minimal limit
      read_only_mode: true
      estimated_duration_hours: 4

# -----------------------------------------------------------------------------
# Capacity Planning (Kapasite Planlama)
# -----------------------------------------------------------------------------
capacity:
  # Otomatik ölçeklendirme eşikleri
  autoscaling:
    enabled: true
    
    # Backend replica scaling
    backend:
      min_replicas: 2
      max_replicas: 10
      cpu_threshold: 70  # %70 CPU'da scale up
      memory_threshold: 80  # %80 memory'de scale up
    
    # Worker replica scaling
    worker:
      min_replicas: 2
      max_replicas: 20
      queue_length_threshold: 100  # 100 job'da scale up
      processing_time_threshold: 300  # 5 dakikalık işlem süresi
    
    # Database connection pool
    database:
      min_connections: 10
      max_connections: 100
      scale_up_threshold: 80  # %80 kullanımda scale up
  
  # Kapasite limitleri
  limits:
    # Global
    max_concurrent_uploads: 200
    max_concurrent_analysis: 100
    max_daily_missions: 5000
    
    # Per user
    max_missions_per_farmer_per_day: 10
    max_missions_per_coop_per_day: 100
    max_missions_per_pilot_per_day: 50
  
  # Yedek kapasite (rezerv)
  reserve:
    percentage: 20  # %20 kapasite rezerve (acil durum için)
    priority_roles: [ADMIN, EXPERT]  # Bu roller rezervden kullanabilir

# -----------------------------------------------------------------------------
# Monitoring & Alerts
# -----------------------------------------------------------------------------
monitoring:
  # Seasonal metrics
  metrics:
    track_by_season: true
    track_by_region: true
    track_by_crop: true
  
  # Alert conditions
  alerts:
    # Sezonsal yoğunluk uyarısı
    high_seasonal_load:
      threshold: 80  # %80 kapasite
      severity: warning
    
    # Bölgesel kapasite aşımı
    regional_capacity_exceeded:
      threshold: 90  # %90 kapasite
      severity: critical
    
    # Beklenmedik sezon dışı yoğunluk
    off_season_spike:
      threshold_multiplier: 3.0  # Normal'in 3 katı
      severity: warning

# -----------------------------------------------------------------------------
# Configuration Update Schedule
# -----------------------------------------------------------------------------
updates:
  # Bu konfigürasyon her sezon başında gözden geçirilir
  review_schedule:
    - month: 3   # Mart (ilkbahar)
    - month: 6   # Haziran (yaz)
    - month: 9   # Eylül (hasat)
    - month: 12  # Aralık (kış)
  
  # Değişiklik onayı
  approval_required: true
  approved_by_role: ADMIN
  audit_log: true

# =============================================================================
# NOTES
# =============================================================================
# 
# SSOT Uyumluluğu:
# ----------------
# - Tarama sıklıkları KR-024'e göre tanımlanmış
# - Pamuk: 14 gün (büyüme), 7 gün (hasat)
# - Mısır: 10 gün (büyüme)
# - Sebze: 7 gün (aktif sezon)
# - Bitki türü değişikliği Ekim-Aralık (KR-013)
# 
# Sezonsal Strateji:
# ------------------
# - Her bitki türü için farklı sezon tanımları
# - Dinlenme sezonunda minimal limit
# - Hasat sezonunda maksimum limit
# - Bölgesel öncelikler (GAP başta)
# 
# Dinamik Ayarlama:
# -----------------
# - Sezonlar otomatik tespit edilir
# - Rate limitler multiplier ile çarpılır
# - base_limits.yaml değerleri override edilmez, çarpılır
# - Acil durum modları tanımlanmış
# 
# Kapasite Planlama:
# ------------------
# - Otomatik ölçeklendirme eşikleri
# - Per-user günlük limitler
# - Rezerv kapasite (%20)
# - Backend/worker replica stratejisi
# 
# Monitoring:
# -----------
# - Sezon, bölge, bitki bazlı metrikler
# - Alert threshold'ları tanımlanmış
# - Quarterly review schedule
# 
# =============================================================================

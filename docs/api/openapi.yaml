# BOUND: TARLAANALIZ_SSOT_v1_0_0.txt – canonical rules are referenced, not duplicated.
openapi: 3.1.0
info:
  title: TarlaAnaliz Platform API
  version: 1.0.0
  description: |
    BOUND: TARLAANALIZ_SSOT_v1_0_0.txt – canonical rules are referenced, not duplicated.
servers:
  - url: https://api.example.local
security:
  - bearerAuth: []
paths:
  /health:
    get:
      summary: Health check
      security: []
      responses:
        '200':
          description: Service healthy
  /v1/payments/intents:
    post:
      summary: Create payment intent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentIntent'
      responses:
        '201':
          description: Created
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/Unprocessable'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/payments/{intent_id}/receipt:
    post:
      summary: Upload receipt for intent
      parameters:
        - in: path
          name: intent_id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentReceiptUpload'
      responses:
        '202':
          description: Accepted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/Unprocessable'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/payments/{intent_id}:
    get:
      summary: Get payment intent status
      parameters:
        - in: path
          name: intent_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentApproval'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/admin/payments/pending:
    get:
      summary: List pending payments
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PaymentApproval'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/admin/payments/{payment_id}/approve:
    post:
      summary: Approve payment
      parameters:
        - in: path
          name: payment_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Approved
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/admin/payments/{payment_id}/reject:
    post:
      summary: Reject payment
      parameters:
        - in: path
          name: payment_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Rejected
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/calibration/records:
    post:
      summary: Create calibration record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalibrationRecord'
      responses:
        '201':
          description: Created
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/Unprocessable'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
    get:
      summary: List calibration records
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CalibrationRecord'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/calibration/records/{record_id}:
    get:
      summary: Get calibration record
      parameters:
        - in: path
          name: record_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationRecord'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/qc/reports:
    post:
      summary: Create QC report
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QCReport'
      responses:
        '201':
          description: Created
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/Unprocessable'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
    get:
      summary: List QC reports
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/QCReport'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/qc/reports/{report_id}:
    get:
      summary: Get QC report
      parameters:
        - in: path
          name: report_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QCReport'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/sla/summary:
    get:
      summary: Get SLA summary
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SLASummary'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
  /v1/sla/breaches:
    get:
      summary: Get SLA breaches
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SLABreach'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalError'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unprocessable:
      description: Unprocessable
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    TooManyRequests:
      description: Too many requests
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    PaymentIntent:
      type: object
      required: [subject_id, amount, currency, plan_code]
      properties:
        subject_id:
          type: string
        plan_code:
          type: string
        amount:
          type: number
          format: double
        currency:
          type: string
          example: TRY
        idempotency_key:
          type: string
    PaymentReceiptUpload:
      type: object
      required: [receipt_uri, uploaded_by]
      properties:
        receipt_uri:
          type: string
        uploaded_by:
          type: string
        note:
          type: string
    PaymentApproval:
      type: object
      required: [payment_id, subject_id, state, updated_at]
      properties:
        payment_id:
          type: string
        subject_id:
          type: string
        state:
          type: string
          enum: [intent_created, receipt_uploaded, pending_manual_approval, approved, paid, rejected]
        updated_at:
          type: string
          format: date-time
        audit_ref:
          type: string
    CalibrationRecord:
      type: object
      required: [record_id, mission_id, status, qc_evidence_ref]
      properties:
        record_id:
          type: string
        mission_id:
          type: string
        status:
          type: string
          enum: [calibrated, failed]
        qc_evidence_ref:
          type: string
    QCReport:
      type: object
      required: [report_id, mission_id, result, reviewed_at]
      properties:
        report_id:
          type: string
        mission_id:
          type: string
        result:
          type: string
          enum: [pass, fail]
        reviewed_at:
          type: string
          format: date-time
        reviewer_subject_id:
          type: string
    SLASummary:
      type: object
      required: [period_start, period_end, breach_count]
      properties:
        period_start:
          type: string
          format: date-time
        period_end:
          type: string
          format: date-time
        breach_count:
          type: integer
        p95_resolution_minutes:
          type: integer
    SLABreach:
      type: object
      required: [breach_id, category, opened_at, status]
      properties:
        breach_id:
          type: string
        category:
          type: string
        opened_at:
          type: string
          format: date-time
        status:
          type: string
          enum: [open, mitigated, closed]
        correlation_id:
          type: string
    ErrorResponse:
      type: object
      required: [code, message, correlation_id]
      properties:
        code:
          type: string
        message:
          type: string
        correlation_id:
          type: string
